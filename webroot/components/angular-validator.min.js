(function(){var m;m=angular.element;angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(p){return{restrict:"A",require:"ngModel",link:function(g,q,b){var f,c,a,n,d,l,s,k,t;c=p.get("$validator");f=p.get("$parse");n=f(b.ngModel);k=[];t=function(r,e){var h,c,a,d,f,l,s;null==e&&(e={});h=d=0;c=function(){var a,h,c;if(++d===k.length){h=0;for(c=k.length;h<c;h++)a=k[h],a.success(n(g),g,q,b,p);"function"===typeof e.success&&e.success()}};s=[];f=0;for(l=
k.length;f<l;f++){a=k[f];switch(r){case "blur":if("blur"!==a.invoke)continue;a.enableError=!0;break;case "watch":if("watch"!==a.invoke&&!a.enableError){c();continue}break;case "broadcast":a.enableError=!0}s.push(function(a){return a.validator(n(g),g,q,b,{success:function(){return c()},error:function(){a.enableError&&1===++h&&a.error(n(g),g,q,b,p);if(1===("function"===typeof e.error?e.error():void 0)){try{q[0].scrollIntoViewIfNeeded()}catch(c){}return q[0].select()}}})}(a))}return s};l=function(){var a;
a=c.getRule("required");null==a&&(a=c.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return k.push(a)};s=function(a){var e,h,c,f,d;d=[];e=h=0;for(c=k.length;h<c;e=h+=1)(null!=(f=k[e])?f.name:void 0)===a&&(k[e].success(n(g),g,q,b,p),k.splice(e,1),d.push(e--));return d};b.$observe("validator",function(a){var e,h,f,n;k.length=0;(d.validatorRequired||d.required)&&l();if(e=a.match(/^\/(.*)\/$/))h=c.convertRule("dynamic",{validator:RegExp(e[1]),invoke:b.validatorInvoke,error:b.validatorError}),
k.push(h);else if(e=a.match(/^\[(.*)\]$/)){a=e[1].split(",");n=[];e=0;for(f=a.length;e<f;e++)h=a[e],h=c.getRule(h.replace(/^\s+|\s+$/g,"")),"function"===typeof h.init&&h.init(g,q,b,p),h?n.push(k.push(h)):n.push(void 0);return n}});b.$observe("validatorError",function(a){var e;if(e=b.validator.match(/^\/(.*)\/$/))return s("dynamic"),a=c.convertRule("dynamic",{validator:RegExp(e[1]),invoke:b.validatorInvoke,error:a}),k.push(a)});d={validatorRequired:!1,required:!1};b.$observe("validatorRequired",function(a){if(a&&
"false"!==a)return l(),d.validatorRequired=!0;if(d.validatorRequired)return s("required"),d.validatorRequired=!1});b.$observe("required",function(a){if(a&&"false"!==a)return l(),d.required=!0;if(d.required)return s("required"),d.required=!1});a=function(a,e){var c,d;if(e){if(b.validatorGroup===e)return!0;if(a.targetScope===g)return 0===b.ngModel.indexOf(e);c=function(a,e){var b,d;for(b in a)switch(d=a[b],typeof d){case "string":if("$$hashKey"===b&&d===e)return!0;break;case "object":if(c(d,e))return!0}return!1};
d=b.ngModel.indexOf(".");d=0<=d?b.ngModel.substr(0,d):b.ngModel;d=f(d)(g);return c(f(e)(a.targetScope),d.$$hashKey)}return!0};g.$on(c.broadcastChannel.prepare,function(c,e){if(a(c,e.model))return e.accept()});g.$on(c.broadcastChannel.start,function(c,e){if(a(c,e.model))return t("broadcast",{success:e.success,error:e.error})});g.$on(c.broadcastChannel.reset,function(c,e){var h,d,f;if(a(c,e.model))for(d=0,f=k.length;d<f;d++)h=k[d],h.success(n(g),g,q,b,p),"watch"!==h.invoke&&(h.enableError=!1)});g.$watch(b.ngModel,
function(a,e){if(a!==e)return t("watch",{oldValue:e})});return m(q).bind("blur",function(){return g.$apply(function(){return t("blur")})})}}}])}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var m;m=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var p,g,q;q=g=p=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(b){p=b;g=p.get("$q");return q=p.get("$timeout")};this.convertError=function(b){var f;if("function"===typeof b)return b;f=b.constructor===String?b:"";return function(c,a,b,d){var l,g,k;a=m(b).parent();for(c=[];0!==a.length;){if(a.hasClass("form-group")){a.addClass("has-error");
k=a.find("label");l=0;for(g=k.length;l<g;l++)a=k[l],m(a).hasClass("error")&&m(a).remove();a=m("<label class='control-label error'>"+f+"</label>");d.id&&a.attr("for",d.id);m(b).parent().append(a);break}c.push(a=a.parent())}return c}};this.convertSuccess=function(b){return"function"===typeof b?b:function(b,c,a){var g,d;c=m(a).parent();for(b=[];0!==c.length;){if(c.hasClass("has-error")){c.removeClass("has-error");d=c.find("label");a=0;for(g=d.length;a<g;a++)c=d[a],m(c).hasClass("error")&&m(c).remove();
break}b.push(c=c.parent())}return b}};this.convertValidator=function(b){var f;f=function(){};b.constructor===RegExp?f=function(c,a,f,d,g){null==c&&(c="");return b.test(c)?"function"===typeof g.success?g.success():void 0:"function"===typeof g.error?g.error():void 0}:"function"===typeof b&&(f=function(c,a,f,d,l){return g.all([b(c,a,f,d,p)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof l.success?l.success():void 0:"function"===typeof l.error?l.error():void 0},function(){return"function"===
typeof l.error?l.error():void 0})});return f};this.convertRule=function(b){return function(f,c){var a,g,d;null==c&&(c={});a={name:f,enableError:"watch"===c.invoke,invoke:c.invoke,init:c.init,validator:null!=(g=c.validator)?g:function(){return!0},error:null!=(d=c.error)?d:"",success:c.success};a.error=b.convertError(a.error);a.success=b.convertSuccess(a.success);a.validator=b.convertValidator(a.validator);return a}}(this);this.register=function(b,f){null==f&&(f={});return this.rules[b]=this.convertRule(b,
f)};this.getRule=function(b){return this.rules[b]?this.rules[b]:null};this.validate=function(b){return function(f,c){var a,n,d,l,m,k,t,r;r=g.defer().promise;k=m=l=0;a=[];n=[];d=[];r.success=function(e){a.push(e);return r};r.error=function(a){n.push(a);return r};r.then=function(a){d.push(a);return r};t={model:c,accept:function(){return l++},success:function(){var c,b,f;if(++m===l){b=0;for(f=a.length;b<f;b++)c=a[b],c();b=0;for(f=d.length;b<f;b++)c=d[b],c()}return m},error:function(){var a,b,c;if(0===
k++){b=0;for(c=n.length;b<c;b++)a=n[b],a();b=0;for(c=d.length;b<c;b++)a=d[b],a()}return k}};f.$broadcast(b.broadcastChannel.prepare,t);q(function(){var b,c,d;if(0===l)for(c=0,d=a.length;c<d;c++)b=a[c],b();else return b=p.get("$validator"),f.$broadcast(b.broadcastChannel.start,t)});return r}}(this);this.reset=function(b){return function(f,c){return f.$broadcast(b.broadcastChannel.reset,{model:c})}}(this);this.get=function(b){this.setupProviders(b);return{rules:this.rules,broadcastChannel:this.broadcastChannel,
register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
